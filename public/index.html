<div id="container"></div>

<script>
  fetch('titanic-passengers.json')
    .then(res => res.json())
    .then(json => json.map((person) => person.fields))
    .then(cleanJson => handleData(cleanJson)) // Call handleData()
    .catch(err => console.log(err))

  // This function handles the loaded JSON data
  function handleData(data) {
    const sample = data.reduce((acc, person) => {
      if (0.75 < Math.random()) {
        return [...acc, person]
      }
      return acc
    }, [])

    const fare = sample.map(person => person.fare)
    const sex = sample.map(person => person.sex)
    const familySize = sample.map(person => person.parch + person.sibsp)
    const embarked = sample.map(person => person.embarked)
    const age = sample.map(person => person.age)

    const chartHeight = Math.max(...fare)
    const chartWidth = sample.length * 5
    createHistogram(fare, familySizes, chartWidth, chartHeight)
    // createHistogram(fare, sex, chartWidth, chartHeight)
    // createHistogram(fare, embarked, chartWidth, chartHeight)
    // createHistogram(familySize, embarked, chartWidth, chartHeight)
  }

  function normalize(dataArr) {
    const maxVal = Math.max(...dataArr)
    const normalArr = dataArr.map(val => val / maxVal * 100)
    return normalArr
  }

  // From https://stackoverflow.com/questions/11499268/sort-two-arrays-the-same-way
  function sortTwoArrs(sortByArr, arrTwo) {
    // combine
    const objList = []
    for(let i = 0; i < sortByArr.length; i++) {
      objList.push({one: sortByArr[i], two: arrTwo[i]})
    }

    // sort
    objList.sort((a, b) => a.one - b.one)

    // separate
    for(var j = 0; j < objList.length; j++) {
      sortByArr[j] = objList[j].one;
      arrTwo[j] = objList[j].two;
    }

    return {sortedNormalData: sortByArr, sortedPersonColor: arrTwo}
  }

  function createHistogram(personY, personColor, chartWidth, chartHeight) {
    const normalData = normalize(personY)
    const colors = ["crimson", "orange", "khaki", "chartreuse", "darkolivegreen",
                    "darkturquoise", "dodgerblue", "navy", "darkviolet", "hotpink"]
    const personColorSet = [...(new Set(personColor))]
    const step = chartWidth / normalData.length
    const chart = document.createElement('div')

    const {sortedNormalData, sortedPersonColor} = sortTwoArrs(normalData, personColor)

    container.appendChild(chart)
    chart.style.display = 'flex'
    chart.style.alignItems = 'flex-end'
    chart.style.width = `${chartWidth}px`
    chart.style.height = `${chartHeight}px`

    for (let i = 0; i < sortedNormalData.length; i++) {
      const bar = document.createElement('div')
      chart.appendChild(bar)

      bar.style.backgroundColor = colors[personColorSet.indexOf(sortedPersonColor[i])]
      bar.style.height = (sortedNormalData[i]) ? `${sortedNormalData[i]}%` : `0.5%`
      bar.style.width = `${step}px`
      bar.style.marginRight = '1px'
      bar.style.marginLeft = '1px'
    }

    const key = document.createElement('div')
    container.appendChild(key)

    for (let i = 0; i < personColorSet.length; i++) {
      const color = document.createElement('div')
      key.appendChild(color)

      const colorName = document.createElement('span')
      color.appendChild(colorName)

      colorName.innerHTML = `${colors[i]}: `
      colorName.style.fontSize = '24px'
      colorName.style.color = colors[i]

      const personColorInfo = document.createElement('span')
      color.appendChild(personColorInfo)

      personColorInfo.innerHTML = `${personColorSet[i]}`
      personColorInfo.style.fontSize = '24px'
      personColorInfo.style.color = 'black'
    }
  }
</script>
